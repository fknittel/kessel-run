<!DOCTYPE html>
<html>
  <head>
    <title>Kessel Run</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="pure-min.css">
    <link rel="stylesheet" href="custom.css">
  </head>
  <body>
    <script>
      // Redirect to '/prod/' which is necessary for all relative
      // paths to work.
      if (window.location.pathname.endsWith('/prod')) {
        window.location = window.location + '/';
      }
    </script>

    <div class="layout">
      <header class="pure-g">
        <div class="pure-u-1-5 monogram">
          K
        </div>
        <div class="pure-u-4-5 l-box">
          <h1>Kessel Run</h1>
          <small><em>Powered by Parsec</em></small>
        </div>
      </header>
      <div class="l-box">
        <button class="pure-button" id="poll-btn">Refresh</button>
        <table class="pure-table">
          <tr>
            <th>Instance IP</th>
            <td>
              <a href="javascript:void(0);" id="copy-public-ip" class="copy-link" disabled="true" title="Copy to clipboard">ðŸ“‹</a>
              <span id="publicIpAddress">Loading...</span>
            </td>
            <td>
            </td>
          </tr>
          <tr>
            <th>Allowed IP Address</td>
            <td id="clientIp">Loading...</td>
            <td>
              <button class="pure-button" id="update-to-me-btn" disabled="true">Change to <span id="requestIp">me</span></button>
            </td>
          </tr>
          <tr>
            <th>Instance State</th>
            <td id="instanceState">Loading...</td>
            <td>
              <div class="pure-button-group" role="group">
                <button class="pure-button" id="start-btn" disabled="true">Start</button>
                <button class="pure-button" id="stop-btn" disabled="true">Stop</button>
              </div>
            </td>
          </tr>
          <tr>
            <th>Administrator Password</th>
            <td>
              <a href="javascript:void(0);" id="copy-password-btn" class="copy-link" disabled="true" title="Copy to clipboard">ðŸ“‹</a>
              <span id="adminPassword">(Click button)</span>
            </td>
            <td>
              <button class="pure-button" id="password-btn">Retrieve password</button>
            </td>
          </tr>
        </table>
        <pre id="oops">
        </pre>
        <h1>First Run Steps</h1>
        <p>
          On first run <em>only</em>, log on to the machine using RDP (Username: <strong>Administrator</strong>, password: click the button above).
        </p>
        <p>Do the following:</p>

        <ul>
          <li>Mark the device as running on a <strong>Public</strong> network.</li>
          <li>Run the following in the PowerShell ISE (takes ~15 minutes and requires you to type <tt>Y</tt> a couple of times):
            <pre>[Net.ServicePointManager]::SecurityProtocol = "tls12, tls11, tls"
    $ScriptWebArchive = "https://github.com/parsec-cloud/Parsec-Cloud-Preparation-Tool/archive/master.zip"
    $LocalArchivePath = "$ENV:UserProfile\Downloads\Parsec-Cloud-Preparation-Tool"
    (New-Object System.Net.WebClient).DownloadFile($ScriptWebArchive, "$LocalArchivePath.zip")
    Expand-Archive "$LocalArchivePath.zip" -DestinationPath $LocalArchivePath -Force
    CD $LocalArchivePath\Parsec-Cloud-Preparation-Tool-master\ | powershell.exe .\loader.ps1</pre>
            (Using the <a target="_blank" href="https://github.com/parsec-cloud/Parsec-Cloud-Preparation-Tool">Parsec Cloud Preparation Tool</a>)
          </li>
          <li>Log into Parsec with your email address and password (you will need to verify the login from your mailbox)</li>
          <li>Finally reboot the machine and use Parsec to connect to it</li>
        </ul>
      </div>
    </div>
    <script src="jquery-3.5.1.min.js"></script>
    <script src="main.js"></script>
  </body>
</html>